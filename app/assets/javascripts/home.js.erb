$(document).ready(function(){
  renderBoard();
  renderPieces();
  movePieceListener();
});


function renderBoard(){
  $.makeArray($(".row")).forEach(function(row, y){
    $(row).html(renderRow(row, y));
  });
}

function renderRow(row, y){
  var html = "";
  if($(row).hasClass('even')){
    for(var i=0; i<4; i++){
      html = html + new Square("off", 2 * i, y).render() + new Square("on", 2 * i + 1, y).render();
    }
  } else if($(row).hasClass('odd')){
    for(var i=0; i<4; i++){
      html = html + new Square("on", 2 * i, y).render() + new Square("off", 2 * i + 1, y).render();
    }
  }
  return html;
}

function renderPieces(){
  // if($(row).hasClass('.p2-start'))
  $.makeArray($('.p2-start > .on')).forEach(function(square, index){
    new Piece(Square.findByPosition($(square).attr('x'), $(square).attr('y')), 'p2').goToSquare();
  })
  $.makeArray($('.p1-start > .on')).forEach(function(square, index){
    new Piece(Square.findByPosition($(square).attr('x'), $(square).attr('y')), 'p1').goToSquare();
  })
  // $('.p2-start > .on').append('<%= image_tag "burger", class:"p2 piece"%>')
  // $('.p1-start > .on').append('<%= image_tag "yellow-burger", class:"p1 piece"%>')
}

function movePieceListener(){
  $('.piece').on('click', function(e){
    e.stopPropagation();
    $('.piece').off();
    if ($(".selected").length == 0){
    var piece = this;
      $(this).parent().toggleClass("selected");
    }
    $('.on').on('click', function(e){
      if ($(this).html() === ""){
        // e.stopPropagation();
        $(this).html(piece);
        $('.selected').html('');
        $('.on').off()
        movePieceListener()
      }
      $('.selected').toggleClass('selected');
      piece = ''
    });
  });
}

function getPosition(square){
  return square.attr('position').split(',').map(Number);
}
