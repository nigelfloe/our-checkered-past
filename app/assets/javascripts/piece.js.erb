var Piece = function(player){
  this.square = null;
  this.player = player;
  this.isKing = false;
  Piece.all.push(this);
}

Piece.all = [];

Piece.findOnClick = function(imageTag){
  var square = $(imageTag).parent();
  return Square.findByJSquare(square).piece;
};

Piece.prototype.goToSquare= function(newSquare){
  this.square = newSquare;
  this.square.piece = this;
  this.square.jSquare().append(this.render());
};

Piece.prototype.render = function () {
  if (this.player.name == 'p2'){
    return '<%= image_tag "burger", class:"p2 piece"%>'
  } else if (this.player.name == 'p1'){
    return '<%= image_tag "yellow-burger", class:"p1 piece"%>'
  }
};

Piece.prototype.move = function(newSquare){
  this.toggleHighlight();
  this.leaveSquare();
  this.goToSquare(newSquare);
};

Piece.prototype.toggleHighlight = function(){
  this.legalMoves().forEach(function(square){
    square.jSquare().toggleClass('highlighted');
  });
  this.square.jSquare().toggleClass('highlighted');
};

Piece.prototype.legalMoves = function(){
  var moves = [];

  // if (this.player.name == "p1"){
  //   var leftMove = this.left;
  //   var rightMove = Square.findByPosition(this.square.positionX + 1, this.square.positionY - 1);
  // } else if (this.player.name == "p2"){
  //   var leftMove = Square.findByPosition(this.square.positionX - 1, this.square.positionY + 1);
  //   var rightMove = Square.findByPosition(this.square.positionX + 1, this.square.positionY + 1);
  // }



  if (!!this.left() && !this.left().piece){moves.push(this.left())};
  if (!!this.right() && !this.right().piece){moves.push(this.right())};
  // debugger
  return moves;
};

//left and right determined by P1 perspective
Piece.prototype.left = function(){
  if (this.player.name == "p1"){
    return Square.findByPosition(this.square.positionX - 1, this.square.positionY - 1);
  } else if (this.player.name == "p2"){
    return Square.findByPosition(this.square.positionX - 1, this.square.positionY + 1)
  }
};

//left and right determined by P1 perspective
Piece.prototype.right = function(){
  if (this.player.name == "p1"){
    return Square.findByPosition(this.square.positionX + 1, this.square.positionY - 1)
  } else if (this.player.name == "p2"){
    return Square.findByPosition(this.square.positionX + 1, this.square.positionY + 1)
  }
}


Piece.prototype.leaveSquare = function(){
  this.square.jSquare().html('');
  this.square.piece = null;
};
//
// Piece.prototype.jumpAvailable = function(){
//   Square.findByPosition(this.square.positionX - 1, this.square.positionY - 1).piece.player == this.player.opponent
// }
